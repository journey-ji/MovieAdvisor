<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>영화추천 시스템</title>
    <link rel="stylesheet" href="./static/css/reset.css">
    <link rel="stylesheet" href="./static/css/style.css">
</head>
<body>
    <header>
        <nav class="nav-bar">
            <h1>Movie Advisor</h1>
        </nav>
    </header>
    <main>
        <div class="wrap">
            <div class="cont-hero">
            </div>
            <div class="cont-movies">
                <h2 class="tit-movies">추천영화</h2>
                <ul>
                    <li class="item-movie"><img id="img1" src="./static/img/sample1.jpg" alt=""></li>
                    <li class="item-movie"><img id="img2" src="./static/img/sample1.jpg" alt=""></li>
                    <li class="item-movie"><img id="img3" src="./static/img/sample1.jpg" alt=""></li>
                    <li class="item-movie"><img id="img4" src="./static/img/sample1.jpg" alt=""></li>
                    <li class="item-movie"><img id="img5" src="./static/img/sample1.jpg" alt=""></li>
                    <li class="item-movie"><img id="img6" src="./static/img/sample1.jpg" alt=""></li>
                    <li class="item-movie"><img id="img7" src="./static/img/sample1.jpg" alt=""></li>
                    <li class="item-movie"><img id="img8" src="./static/img/sample1.jpg" alt=""></li>
                    <li class="item-movie"><img id="img9" src="./static/img/sample1.jpg" alt=""></li>
                    <li class="item-movie"><img id="img10" src="./static/img/sample1.jpg" alt=""></li>
                </ul>
            </div>
            <h2 class="tit-movies">최근 인기 영화</h2>
            <div class="cont-trending">
                <button class="handle left-handle">
                    <div class="text">&#8249;</div>
                </button>
                <div class="slider">
                    <img id="trend-img1" src="https://via.placeholder.com/210/00FF00?text=1" alt="">
                    <img id="trend-img2" src="https://via.placeholder.com/210/00FF00?text=2" alt="">
                    <img id="trend-img3" src="https://via.placeholder.com/210/00FF00?text=3" alt="">
                    <img id="trend-img4" src="https://via.placeholder.com/210/00FF00?text=4" alt="">
                    <img id="trend-img5" src="https://via.placeholder.com/210/00FF00?text=5" alt="">
                    <img id="trend-img6" src="https://via.placeholder.com/210/00FF00?text=6" alt="">
                    <img id="trend-img7" src="https://via.placeholder.com/210/00FF00?text=7" alt="">
                    <img id="trend-img8" src="https://via.placeholder.com/210/00FF00?text=8" alt="">
                    <img id="trend-img9" src="https://via.placeholder.com/210/00FF00?text=9" alt="">
                    <img id="trend-img10" src="https://via.placeholder.com/210/00FF00?text=10" alt="">
                </div>
                <button class="handle right-handle">
                    <div class="text">&#8250;</div>
                </button>
            </div>
            
        </div>
    </main>
    <footer></footer>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script>
        const API = '3978573dbb0bb023a5f7c9fbb4d079aa';
        let posterPath='';
        let movieId = 19995

        const imageURL = `https://image.tmdb.org/t/p/original/${posterPath}`
        let movieURL = `https://api.themoviedb.org/3/movie/${movieId}?api_key=${API}&language=ko`
        let avatar = 'https://image.tmdb.org/t/p/original/gC3tW9a45RGOzzSh6wv91pFnmFr.jpg'
        let movieList = {
            img1 :null,
            img2 :null,
            img3 :null,
            img4 :null,
            img5 :null,
            img6 :null,
            img7 :null,
            img8 :null,
            img9 :null,
            img10 :null,
        }

        function data_fetch(data) {
            // 1. 처음 페이지 로드할 때,
            // 2. 이미지 눌러서 데이터 받아왔을 때

            // 초기 파이썬 데이터 받아오기
            if(data==='first-page-load'){
                fetch("http://localhost:3000/test")
                .then(response => response.json())
                .then(response => {
                    // 입력받은 문자열을 movieId & title 로 나뉜 배열로 반환
                    let temp = response.split('\r\n').filter((ele,idx)=>idx<=10&&idx>0)
                    temp.forEach((e,idx,arr) => {
                        arr[idx] = e.replace(' ',',').split(',')
                        arr[idx][1] = arr[idx][1].trim()
                        arr[idx] = arr[idx][1].replace(' ',',').split(',')
                        arr[idx][1] = arr[idx][1].trim()
                        arr[idx][0] = parseInt(arr[idx][0])
                    });
                    console.log(temp)
                    
                    
                    // 10개 영화 포스터 입력 함수화하기
                    // 음,,, 저장할 목록 : imagepath, 
                    for(let i=0; i<10;i++){
                        // 클라이언트의 영화목록에 movieId 저장
                        movieList[`img${i+1}`] = parseInt(temp[i][0])
                        fetch(`https://api.themoviedb.org/3/movie/${temp[i][0]}?api_key=${API}&language=ko`)
                        .then(response=>response.json())
                        .then(response=>{
                            document.querySelector(`#img${i+1}`).setAttribute('src','https://image.tmdb.org/t/p/original'+response.poster_path)
                        })
                    }
                    
                })
            }else{
                let temp = data.split('\r\n').filter((ele,idx)=>idx<=10&&idx>0)
                temp.forEach((e,idx,arr) => {
                    arr[idx] = e.replace(' ',',').split(',')
                    arr[idx][1] = arr[idx][1].trim()
                    arr[idx] = arr[idx][1].replace(' ',',').split(',')
                    arr[idx][1] = arr[idx][1].trim()
                    arr[idx][0] = parseInt(arr[idx][0])
                });
                console.log(temp)
                for(let i=0; i<10;i++){
                // 클라이언트의 영화목록에 movieId 저장
                movieList[`img${i+1}`] = parseInt(temp[i][0])
                fetch(`https://api.themoviedb.org/3/movie/${temp[i][0]}?api_key=${API}&language=ko`)
                .then(response=>response.json())
                .then(response=>{
                    document.querySelector(`#img${i+1}`).setAttribute('src','https://image.tmdb.org/t/p/original'+response.poster_path)
                })
                }
            }
        }
        
        


        // 10개의 이미지에 대하여 클릭시 이벤트 설정
        // 이미지 클릭하면, 동작되어야 할 일
        // 1. 해당 이미지에 대한 데이터 전송 ㅇㅋ 
        // 2. 서버에서 데이터 받아서, 선호리스트에 데이터 저장 후, ㅇㅋ 
        // 3. 파이썬에 해당 선호리스트 보내서 다시 10개의 영화 추천 ㅇㅋ
        // 4. 추천된 10개의 영화에 대한 데이터를 다시 클라이언트에게 보내줌 localhost:3000/test로
        // 10월 24일 이미지클릭 이벤트 구현 완료
        function imageClick_set(){
            for(let i=1; i<=10;i++){
                $(function(){
                    $(`#img${i}`).click(function(){   //submit 버튼을 클릭하였을 때
                        $.ajax({
                            type:'post',   //post 방식으로 전송
                            url:'/test',   //데이터를 주고받을 파일 주소
                            data: {
                                name : `${i}번째 아이템`,
                                movieId : parseInt(movieList[`img${i}`]),
                            },
                            dataType:'json',   //json 파일 형식으로 값을 담아온다.
                            success : function(data){   //파일 주고받기가 성공했을 경우
                                data_fetch(data)
                            },
                            error : function(err) {     // 실패 시
                                console.log("failed : " + err);
                            }
                        });
                    });
                });
            }
        }



        // 오늘의 트렌드 영화 
        const tredingMoiveList = ()=>{
            fetch('https://api.themoviedb.org/3/trending/all/day?api_key=3978573dbb0bb023a5f7c9fbb4d079aa&language=ko-KR')
            .then(response=>response.json())
            .then(data =>{
                for(let i of data['results']){
                    console.log(i['title'])
                }
            })
        }




        data_fetch('first-page-load')
        imageClick_set()
        tredingMoiveList()
    </script>
    
</body>
</html>

<!-- 할 일 
 1. 최근 인기영화 슬라이드 작성
 2. 내가 선택한 영화 슬라이드 작성 
 3. 추천영화 css 깔끔하게 수정 / 11월 7일 완료

-->